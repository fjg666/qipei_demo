<?phprequire_once(MO_LIB_DIR . '/DBAction.class.php');require_once(MO_LIB_DIR . '/JurisdictionAction.class.php');require_once(MO_LIB_DIR . '/LaiKeLogUtils.class.php');class Add_nameAction extends Action {    /**     * <p>Copyright (c) 2018-2019</p>     * <p>Company: www.laiketui.com</p>     * @author 段宏波     * @date 2018/12/12  18:54     * @version 1.0     */	public function getDefaultView() {        $db = DBAction::getInstance();        $request = $this->getContext()->getRequest();        return View :: INPUT;	}    /**     * <p>Copyright (c) 2018-2019</p>     * <p>Company: www.laiketui.com</p>     * @author 段宏波     * @date 2018/12/12  18:54     * @version 1.0     */	public function execute(){		$db = DBAction::getInstance();        $JurisdictionAction = new JurisdictionAction();        $lktlog = new LaiKeLogUtils("common/data_dictionary.log");        // 1.开启事务        $db->begin();		$request = $this->getContext()->getRequest();        $store_id = $this->getContext()->getStorage()->read('store_id');        $admin_name = $this->getContext()->getStorage()->read('admin_name');        // 接收数据        $name = addslashes($request->getParameter('name')); // 数据名称        $status = addslashes($request->getParameter('status')); // 是否生效        if($name == ''){            echo json_encode(array('status' =>'数据名称不能为空！' ));exit;        }else{            $sql0 = "select * from lkt_data_dictionary_name where name = '$name' and recycle = 0";            $r0 = $db->select($sql0);            if($r0){                echo json_encode(array('status' =>'数据名称'.$name.'已存在！' ));exit;            }        }        $sql1 = "insert into lkt_data_dictionary_name(name,status,admin_name,add_date) values ('$name','$status','$admin_name',CURRENT_TIMESTAMP)";        $r1 = $db->insert($sql1);        if($r1 == -1){            $JurisdictionAction->admin_record($store_id,$admin_name,'添加数据字典名称失败',1);            $Log_content = __METHOD__ . '->' . __LINE__ . ' 添加数据字典名称失败 ';            $lktlog->customerLog($Log_content);            $db->rollback();            echo json_encode(array('status' => '未知原因，添加失败！'));exit;        }else{            $JurisdictionAction->admin_record($store_id,$admin_name,'添加数据字典名称成功',1);            $Log_content = __METHOD__ . '->' . __LINE__ . ' 添加数据字典名称成功 ';            $lktlog->customerLog($Log_content);            $db->commit();            echo json_encode(array('status' =>'添加成功！' ,'suc'=>'1'));exit;        }	    return;	}	public function getRequestMethods(){		return Request :: POST;	}}?>