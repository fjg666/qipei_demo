<?php/** * [Laike System] Copyright (c) 2018 laiketui.com * Laike is not a free software, it under the license terms, visited http://www.laiketui.com/ for more details. */require_once(MO_LIB_DIR . '/DBAction.class.php');require_once(MO_LIB_DIR . '/Tools.class.php');class AjaxAction extends Action {    /**     * <p>Copyright (c) 2018-2019</p>     * <p>Company: www.laiketui.com</p>     * @author 段宏波     * @date 2018/12/12  18:54     * @version 1.0     */    public function getDefaultView() {        $db = DBAction::getInstance();        $request = $this->getContext()->getRequest();        $data_dictionary_id = addslashes($request->getParameter('data_dictionary_id')); // 数据字典名称ID        $data_dictionary_name = addslashes($request->getParameter('data_dictionary_name')); // 数据字典名称        $rew = '';        if($data_dictionary_name){            $sql = "select max(code) as code from lkt_data_dictionary_list where recycle = 0 and sid = '$data_dictionary_id'";            $r = $db->select($sql);            if($r){                $code = $r[0]->code;                if($code == ''){                    $code1 = substr(strtoupper(Tools::encode($data_dictionary_name)),0);                    $rew = 'LKT_' . $code1 . '_001';                }else{                    $code1 = substr($code,0,strrpos($code,"_"));                    $res1 = trim(strrchr($code, '_'),'_');                    $res2 = $res1+1;                    $numlength = strlen((string)$res2);                    if($numlength > 3){                        $res = $res2;                    }else{                        $res = sprintf("%03d", $res2);                    }                    $rew = $code1 . '_' . $res;                }            }else{                $code1 = substr(strtoupper(Tools::encode($data_dictionary_name)),0);                $rew = 'LKT_' . $code1 . '_001';            }        }        $sql0 = "select id from lkt_data_dictionary_name where status = 1 and recycle = 0 and name = '属性名' ";        $r0 = $db->select($sql0);        if($r0){            $sid = $r0[0]->id;            $sql1 = "select id,text from lkt_data_dictionary_list where status = 1 and recycle = 0 and sid = '$sid' ";            $r1 = $db->select($sql1);        }else{            $r1 = array();        }        echo json_encode(array('code'=>$rew,'list' =>$r1));exit;        return;    }    public function execute(){        return $this->getDefaultView();    }    public function getRequestMethods(){        return Request :: NONE;    }}?>